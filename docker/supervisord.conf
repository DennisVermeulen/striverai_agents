[supervisord]
nodaemon=true
logfile=/app/data/logs/supervisord.log
pidfile=/var/run/supervisord.pid

[program:xvfb]
command=Xvfb :%(ENV_DISPLAY_NUM)s -screen 0 %(ENV_BROWSER_WIDTH)sx%(ENV_BROWSER_HEIGHT)sx24
autorestart=true
priority=10
environment=BROWSER_WIDTH="1280",BROWSER_HEIGHT="800"
stdout_logfile=/app/data/logs/xvfb.log
stderr_logfile=/app/data/logs/xvfb.err

[program:fluxbox]
command=fluxbox
environment=DISPLAY=":%(ENV_DISPLAY_NUM)s"
autorestart=true
priority=20
stdout_logfile=/app/data/logs/fluxbox.log
stderr_logfile=/app/data/logs/fluxbox.err

[program:x11vnc]
command=x11vnc -display :%(ENV_DISPLAY_NUM)s -nopw -listen 0.0.0.0 -rfbport 5900 -shared -forever
autorestart=true
priority=30
stdout_logfile=/app/data/logs/x11vnc.log
stderr_logfile=/app/data/logs/x11vnc.err

[program:novnc]
command=websockify --web /usr/share/novnc 6080 localhost:5900
autorestart=true
priority=40
stdout_logfile=/app/data/logs/novnc.log
stderr_logfile=/app/data/logs/novnc.err

[program:api]
command=/app/.venv/bin/uvicorn local_agent.api.app:create_app --factory --host 0.0.0.0 --port 8000
directory=/app
environment=DISPLAY=":%(ENV_DISPLAY_NUM)s",PYTHONPATH="/app/src",PATH="/app/.venv/bin:%(ENV_PATH)s"
autorestart=true
priority=50
stdout_logfile=/app/data/logs/api.log
stderr_logfile=/app/data/logs/api.err
